---
id: 1766903408-YQAA
aliases: []
tags:
  - Proxmox
  - LXC
  - Headscale
  - apt
  - Debian
  - Ubuntu
---

# Proxmox

## The Start

Ran into issues with #Proxmox #LXC containers not doing great. The issues has
been with the #DNS. #magicDNS from #Headscale was forcing #Proxmox to use it's
DNS address, and all the containers took their DNS from Proxmox so the ones
I hadn't added to #Headscale were not going to be able to find it.

## Tailscale on Debian and Ubuntu

The reason I hadn't put them on for the most part is because #Tailscale isn't
on their #apt. So I had to manually add it to each one.

```bash
curl -fsSL https://tailscale.com/install.sh | sh
```

## Kernel Module "TUN"

Then I found out ANOTHER problem. In order for Tailscale to work you have
to have the kernel module #tun installed and loaded.

### LXCs and TUN

Proxmox has it installed and loaded the crux of the issue is that
containers aren't served up all the modules. You have to give it to them
through manually adding to the bottom of their conf in /etc/pve/lxc.

For Privileged LXCs:

```conf
lxc.cgroup.devices.allow: c 10:200 rwm
lxc.hook.autodev: sh -c "mkdir -p ${LXC_ROOTFS_MOUNT}/dev/net; mknod -m 0666 ${LXC_ROOTFS_MOUNT}/dev/net/tun c 10 200"
```

For Unprivileged LXCs:

```conf
lxc.cgroup.devices.allow: c 10:200 rwm
lxc.mount.entry: /dev/net/tun dev/net/tun none bind,create=file
```

## Final Steps

After restarting the LXC you have to edit /etc/resolv.conf to a DNS IP address
they can actually reach. #Xfinity forces you to use theirs which is
75.75.75.75 or 75.75.76.76. After you do that you can run the standard
Headscale command of

```bash
tailscale up --login-server https://headieheadhead.jorgegetson.duckdns.org
```

Mine is that address. If you're not me reading this you have to put in
your Headscale public URL for it to reach it.

It gives you a link to load in your browser and then it loads a page
that gives you the command to run inside of Headscale terminal.
Just have to change the user to the user you need to add yours too.
